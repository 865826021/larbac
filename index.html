<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>LaRBAC by alexpechkarev</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>LaRBAC</h1>
        <p>Role based access control package for Laravel 5</p>
        <p class="view"><a href="https://github.com/alexpechkarev/larbac">View the Project on GitHub <small>alexpechkarev/larbac</small></a></p>
        <ul>
          <li><a href="https://github.com/alexpechkarev/larbac/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/alexpechkarev/larbac/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/alexpechkarev/larbac">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a id="larbac" class="anchor" href="#larbac" aria-hidden="true"><span class="octicon octicon-link"></span></a>LaRBAC</h1>

<p>Role based access control package for Laravel 5.</p>

<p>Intentions of this package is to apply RBAC abstraction level to promote secure user administration.
Access decisions are based on the roles and permissions individual users have as part of organization. The basic concept is that users obtain permissions by being member of role, where permissions are assigned to roles and roles assigned to users. User-role and permission-role have many-to-many relation, allowing single role have many users and single user have many roles, same applies to permissions. </p>

<p>This package includes frontend interface that allows: </p>

<ul>
<li>create, edit and delete permissions</li>
<li>create, edit and delete roles</li>
<li>assign permissions to roles</li>
<li>assign roles to users</li>
</ul>

<p>By default frontend option is set to <code>true</code>, if you wish to create roles and assign permissions in your own way simply turn this option off in configuration file.</p>

<h2>
<a id="demonstration" class="anchor" href="#demonstration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Demonstration</h2>


<h2>
<a id="requirements" class="anchor" href="#requirements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li><a href="http://laravel.com/">Laravel 5</a></li>
<li><a href="https://github.com/illuminate/html">illuminate/html</a></li>
</ul>

<h2>
<a id="frontend-dependency" class="anchor" href="#frontend-dependency" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frontend dependency</h2>

<ul>
<li>
<a href="http://jquery.com/">jQuery</a> </li>
<li>
<a href="http://getbootstrap.com/">Bootstrap</a> </li>
<li><a href="http://www.virtuosoft.eu/code/bootstrap-duallistbox">Dual listbox</a></li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Install package issuing <a href="https://getcomposer.org/">Composer</a> command in terminal:</p>

<div class="highlight highlight-sh"><pre>$ composer require alexpechkarev/larbac:dev-master</pre></div>

<p>Update provider and aliases arrays in config/app.php with:</p>

<pre><code>
'providers' =&gt; [
    ...
    'Illuminate\Html\HtmlServiceProvider',
    'Larbac\Provider\LarbacServiceProvider',


'aliases' =&gt;[
    ...
    'Form'      =&gt; 'Illuminate\Html\FormFacade',
    'HTML'      =&gt; 'Illuminate\Html\HtmlFacade'


</code></pre>

<p>Publish package assets: </p>

<pre><code>    php artisan vendor:publish

</code></pre>

<p>Package extends default Laravel User Model by defining extra relations and validation methods. 
Tell Laravel to use package User model instead of default Eloquent User model in <code>config/auth.php</code>:</p>

<pre><code>    
#'model' =&gt; 'App\User',
'model'  =&gt; 'Larbac\Models\User',
</code></pre>

<p>Register package middleware with HTTP kernel route array</p>

<pre><code>
protected $routeMiddleware = [
             ...
    'larbac'  =&gt; 'Larbac\Middleware\LarbacMiddleware',
];
</code></pre>

<h4>
<a id="create-database-tables" class="anchor" href="#create-database-tables" aria-hidden="true"><span class="octicon octicon-link"></span></a>Create database tables</h4>

<p>Before running migrations please review table names in migration folder <code>vendor/alexpechkarev/larbac/src/Migration</code> 

If you plan using frontend interface open ```config/larbac.php```: 
 - specify role name that will grant you access to the frontend interface
 - specify user ID to which above role will be assigned

<pre><code>
/*
|--------------------------------------------------------------------------
| User
|--------------------------------------------------------------------------
|
| Specify a user id from users table to which you would like assigning Admin role
| This is required in order to obtain access to frontend interface
| Can be changed to any other user
|
*/

'user' => 1, 


/*
|--------------------------------------------------------------------------
| Admin role
|--------------------------------------------------------------------------
|
| Role that required in order to obtain access to frontend interface
|
*/

'role' => 'Admin',       
    

</code></pre>  

Four additional tables required to store roles and permissions data along with their relations data. 
By default following tables will be created <code>[ tbl_permissions, tbl_roles, tbl_role_user, tbl_permission_role ]</code><br>
Table names and table prefix can be specified in configuration file <code>config/larbac.php</code></p>

<pre><code>    php artisan migrate

</code></pre>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>After publishing package assets configuration file can be found in <code>config/larbac.php</code></p>

<p>By default frontend interface turned on, to turn this option off see configuration file. 
Forntend interface URL's shown below, defined in configuration file and can be modified at any time. Access to these routes are protected by role, which assigned to user, see config/larbac.php</p>

<pre><code>/*
|---------------------------------------
| Routes
|---------------------------------------
|
| Setting default routes
|
|   User interface can be accessed via          - http://yourdomain.net/user
|   Permission interface can be accessed via    - http://yourdomain.net/permission
|   Roles interface can be accessed via         - http://yourdomain.net/role
|
*/

'routes' =&gt; [

'routeUser'       =&gt; 'user', 
'routePermission' =&gt; 'permission', 
'routeRoles'      =&gt; 'role' 
],

</code></pre>

<h3>
<a id="frontend-interface" class="anchor" href="#frontend-interface" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frontend interface</h3>

<p>Frontend templates depend on additional resources such as Bootstrap, jQuery and Dual List. To add this resource into templates please ensure that default layout template [in this case - resources/views/app.blade.php ] have following section: <code>@section('footer-js') ... @show</code> .  </p>

<pre><code>        
@section('footer-js')
    &lt;!-- Scripts --&gt;
    &lt;script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"&gt;&lt;/script&gt;
    &lt;script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.1/js/bootstrap.min.js"&gt;&lt;/script&gt;
@show  

</code></pre>

<p>Package templates will be using <code>@section('footer-js')</code> adding required javascript files.</p>

<pre><code>
@section('footer-js')
@parent
    // template required resources
@stop

</code></pre>

<h3>
<a id="error-messages" class="anchor" href="#error-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Error messages</h3>

<p>In cases when user do not have sufficient permissions to access requested resource LaRBAC Middleware will use <code>withErrors()</code> method to flash errors. To show error messages create new view <code>larbac-error.blade.php</code> and include code below.  Than include this view in your templates <code>@include('larbac-error')</code>. Error messages can be specified in the configuration file.</p>

<pre><code>
    @if($errors-&gt;has("error"))        
    &lt;div class="alert alert-warning alert-dismissible" role="alert"&gt;
        &lt;button type="button" class="close" data-dismiss="alert"&gt;
            &lt;span aria-hidden="true"&gt;&amp;times;&lt;/span&gt;&lt;span class="sr-only"&gt;Close&lt;/span&gt;
        &lt;/button&gt;
        {{$errors-&gt;first("error")}}
    &lt;/div&gt;
    @endif

</code></pre>

<h2>
<a id="use" class="anchor" href="#use" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use</h2>

<p>After creating your permissions / roles, establishing relations between them and assigning roles to user, access restrictions can be set within your controller. </p>

<pre><code>use Illuminate\Support\Facades\Request;

...
public function __construct()
{
    // Setting role based access
    $permissions = ['role'=&gt;['Admin']  ];


    if( is_object(Request::route()) ) {

        Request::route()-&gt;setParameter('larbac', $permissions);
        $this-&gt;middleware('larbac');  
    }
}

</code></pre>

<p>Varies restriction rules can be set by specifying array of roles, array of permissions or both.</p>

<p>Validating more than one role: </p>

<ul>
<li>user must be assigned to one of the given roles</li>
</ul>

<pre><code>    $permissions = ['role'=&gt;['Admin', 'Staff']  ];
    ....

</code></pre>

<p>Validating more than one role along with permission:</p>

<ul>
<li>user must be assigned to one of the given roles</li>
<li>at least one role must have given permission</li>
</ul>

<pre><code>    $permissions = ['role'=&gt;['Admin', 'Staff'], 'permissions' =&gt; ['view']  ];
    ....

</code></pre>

<p>Validating more than one role along with permission:</p>

<ul>
<li>user must be assigned to one of the given roles</li>
<li>at least one role must have all given permissions</li>
</ul>

<pre><code>    $permissions = ['role'=&gt;['Admin', 'Staff'], 'permissions' =&gt; ['view', 'edit']  ];
    ....

</code></pre>

<p>Permission based validation only:</p>

<ul>
<li>user must have given permission</li>
</ul>

<pre><code>    $permissions = ['permissions' =&gt; ['edit']  ];
    ....

</code></pre>

<p>Assigning access control in routes files:</p>

<pre><code>    
Route::get('/post', 
[
    'middleware' =&gt; 'larbac', 
    'larbac' =&gt; ['role'=&gt;['Admin'], 'permissions' =&gt; ['can_save']  ],

function(){return view('welcome');}
]);

</code></pre>

<a id="frontend-screen-shots" class="anchor" href="#frontend-screen-shots" aria-hidden="true"><span class="octicon octicon-link"></span></a>Frontend screen shots</h2>

<h3>
<a id="permissions" class="anchor" href="#permissions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Permissions</h3>

<p>Create new permission: /permission/create  <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_create.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_create.png" alt=""></p>

<p>View permissions: /permission   <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_view.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_view.png" alt=""></p>

<p>Edit permission: /permission/1/edit/ <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_edit.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_edit.png" alt=""></p>

<p>Delet permission: <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_delete.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/permission_delete.png" alt=""></p>

<h3>
<a id="roles" class="anchor" href="#roles" aria-hidden="true"><span class="octicon octicon-link"></span></a>Roles</h3>

<p>Create new role and assign permission: /role/create  <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_create.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_create.png" alt=""></p>

<p>View roles: /role <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_view.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_view.png" alt=""></p>

<p>Edit role: /role/1/edit/  <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_edit.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/role_edit.png" alt=""></p>

<h3>
<a id="users" class="anchor" href="#users" aria-hidden="true"><span class="octicon octicon-link"></span></a>Users</h3>

<p>View users: /user  <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/user_view.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/user_view.png" alt=""></p>

<p>Assign role to user: /user/1/edit/   <a href="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/user_assign.png">[ view image ]</a><br>
<img src="https://raw.githubusercontent.com/alexpechkarev/larbac/master/src/img/user_assign.png" alt=""></p>

<h2>
<a id="using-without-frontend" class="anchor" href="#using-without-frontend" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using without frontend</h2>

<p>Out of box Laravel comes with model and controllers that handles user registration and authentication process. Here we will create roles and permissions that can be applied to users.
First create roles and permissions:</p>

<pre><code>    
/**
* Creating role
*/
$role = Larbac\Models\Role::create(['name' =&gt; 'Admin']); // assuming role id will be 5

// with optional role description 
$role = Larbac\Models\Role::create(['name' =&gt; 'Admin', 'description' =&gt; 'App administrator']);

/**
* Creating permission
*/
$permission = Larbac\Models\Permission::create(['name' =&gt; 'can_save']); // assuming permission id will be 12

// with optional permission description
$permission = Larbac\Models\Role::create(['name' =&gt; 'can_save', 'description' =&gt; 'Allow save changes']);

</code></pre>

<p>Next assign permission(s) to a Role:</p>

<pre><code>    
/*
* Assigning permission(s) to a role
* 'Admin' role id = 5
* 'can_save' permission id = 12
*/
$role = Larbac\Models\Role::find(5); // find Admin role by id - 5
$role-&gt;permissions()-&gt;sync([12]); // Assign 'can_save',using permission id - 12

</code></pre>

<p>Multiply permissions can also be assigned to a Role by supplying array of permission id's.
To keep in mind that <code>sync( [12,13,14] )</code> will remove any other permissions that have been granted before and not specified in the given array.</p>

<pre><code>
/**
 * Assigning multiply permissions to a Role
 * 
 * 'Admin' role id = 5
 * 
 * 'can_save' id = 12
 * 'can_view' id = 13
 * 'can_edit' id = 14
 */
$role = Larbac\Models\Role::find(1);
$role-&gt;permissions()-&gt;sync([12,13,14]);


...

/**
 * Will revoke 'can_view' id = 13 and only grant given permissions
 * 
 * 'Admin' role id = 5
 * 
 * 'can_save' id = 12
 * 'can_edit' id = 14
 */
$role-&gt;permissions()-&gt;sync( [12,14] );

</code></pre>

<p>Next assign a Role to an User:</p>

<pre><code>
/*
* Assigning role to an user
*/
$user = Larbac\Models\User::find(20); // assuming user id is 20
$user-&gt;roles()-&gt;sync([5]); // Assigning user [id = 20] an Admin role [id = 5]

</code></pre>

<h2>
<a id="support" class="anchor" href="#support" aria-hidden="true"><span class="octicon octicon-link"></span></a>Support</h2>

<p>Discovered an error or would like to suggest an improvement ? Please do email me or open an <a href="https://github.com/alexpechkarev/larbac/issues">issue on GitHub</a></p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>LaRBAC for Laravel 5 is released under the MIT License. See the bundled
<a href="https://github.com/alexpechkarev/larbac/blob/master/LICENSE">LICENSE</a>
file for details.</p>
      </section>
    </div>
    <footer>
      <p>Project maintained by <a href="https://github.com/alexpechkarev">alexpechkarev</a></p>
      <p>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></p>
    </footer>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-60566001-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
